<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AI-powered repository analysis tool for open source and inner source best practices">
    <title>Tune My Repos - Repository Analysis Tool</title>
    <link rel="stylesheet" href="styles.css">
    <script src="config.js"></script>
    <script src="env-loader.js"></script>
    <script src="auth.js"></script>
    <script src="cache.js"></script>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div>
                    <h1>üîß Tune My Repos</h1>
                    <p class="tagline">Evaluate repositories against OSPO best practices</p>
                </div>
                <div id="authControls" class="auth-controls">
                    <div id="authLoading" class="hidden">Loading...</div>
                    <div id="authLoggedOut" class="hidden">
                        <button id="loginBtn" class="secondary-btn">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16" aria-hidden="true">
                                <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
                            </svg>
                            Sign in with GitHub
                        </button>
                        <small class="auth-help">Get higher rate limits (5,000/hour)</small>
                    </div>
                    <div id="authLoggedIn" class="hidden">
                        <span id="authUsername" class="auth-username"></span>
                        <button id="logoutBtn" class="secondary-btn">Sign out</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        <section class="input-section">
            <h2>Analyze Repositories</h2>
            <form id="analyzeForm">
                <div class="form-group">
                    <label for="targetInput">GitHub User, Organization, or Repository</label>
                    <input 
                        type="text" 
                        id="targetInput" 
                        placeholder="e.g., mgifford or civicactions or mgifford/tune-my-repos"
                        required
                        aria-describedby="targetHelp"
                    >
                    <small id="targetHelp">Enter username/org (analyzes all repos) or owner/repo (single repo)</small>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="skipForks" checked>
                        Skip forked repositories (recommended)
                    </label>
                    <small>Forks are typically managed upstream and don't need separate analysis</small>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="forceRefresh">
                        Force refresh (ignore cache)
                    </label>
                    <small>Bypass the 1-hour cache and fetch fresh data from GitHub API</small>
                </div>

                <div id="cacheStatus" class="cache-status hidden"></div>

                <button type="submit" id="analyzeBtn">Analyze Repositories</button>
                
                <div id="paginationControls" class="pagination-controls hidden">
                    <p id="paginationInfo">Showing 50 most recently updated repositories</p>
                    <button type="button" id="loadMoreBtn" class="secondary-btn">Load Next 50</button>
                </div>
            </form>
        </section>

        <section id="loadingSection" class="hidden" aria-live="polite">
            <div class="spinner"></div>
            <p id="progressText">Analyzing repository...</p>
            <div id="batchProgress" class="hidden">
                <div class="progress-bar">
                    <div id="progressFill"></div>
                </div>
                <p id="progressStats"></p>
            </div>
        </section>

        <section id="infoSection" class="hidden info-section" role="status">
            <h3>‚ÑπÔ∏è Note</h3>
            <p id="infoMessage"></p>
        </section>

        <section id="errorSection" class="hidden error-section" role="alert">
            <h3>‚ö†Ô∏è Error</h3>
            <p id="errorMessage"></p>
        </section>

        <section id="resultsSection" class="hidden">
            <div class="results-header">
                <h2>Analysis Results</h2>
                <div class="export-buttons">
                    <button id="exportJson" class="secondary-btn" title="Download complete analysis data">Export JSON</button>
                    <button id="exportMarkdown" class="secondary-btn" title="Download formatted report">Export Markdown</button>
                    <button id="exportCsv" class="secondary-btn" title="Download spreadsheet summary (repos, maturity, issue counts)">Export CSV</button>
                </div>
            </div>

            <div id="summaryStats" class="summary-card hidden">
                <h3>üìä Overall Summary</h3>
                <dl class="summary-grid">
                    <dt>Total Repositories:</dt>
                    <dd id="totalRepos">0</dd>
                    
                    <dt>Average Maturity:</dt>
                    <dd id="avgMaturity">-</dd>
                    
                    <dt>Critical Issues:</dt>
                    <dd id="totalCritical">0</dd>
                    
                    <dt>Important Issues:</dt>
                    <dd id="totalImportant">0</dd>
                </dl>
            </div>

            <div id="resultsContainer"></div>

            <div id="limitationsContainer" class="hidden">
                <h3>‚ö†Ô∏è Limitations</h3>
                <ul id="limitationsList"></ul>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>
                Analysis based on <a href="AGENTS.md">AGENTS.md</a> governance rules.
                This tool provides recommendations, not compliance claims.
            </p>
            <p>
                <a href="https://github.com/mgifford/tune-my-repos">GitHub</a> |
                <a href="AGENTS.md">Documentation</a>
            </p>
        </div>
    </footer>

    <script src="analyzer.js"></script>
    <script src="app.js"></script>
</body>
</html>
